//packa'ages
const axios = require('axios');
const cheerio = require('cheerio')
const url = "https://www.amazon.co.uk/Apple-24-inch-8%E2%80%91core-7%E2%80%91core-ports/dp/B0932Y7SLQ?ref_=ast_slp_dp&th=1"


const product = { name: '', price: '', link: '' };

async function scrape() {
    //fetch data 
    const { data } = await axios.get(url)
    //load up html
    const $ = cheerio.load(data)
    const item = $("div#dp-container");
    //extractiing data
    product.name = $(item).find("h1 span#productTitle").text();
    product.link = url
    const price = $(item)
        .find("span .a-price-whole")
        .first()
        .text()
        .replace(/[,.]/g, "");
    const priceNum = parseInt(price)
    product.price = priceNum
    console.log(product);
    //send an sms 
    if (priceNum < 1000) {
        client.messages
          .create({
            body: `The price of ${product.name} went below ${price}. Purchase it at ${product.link}`,
            from: "+19784876124",
            to: "+40234469",
          })
          .then((message) => {
            console.log(message);
            clearInterval(handle);
          });
      }
      
    }
    
    scrape();
